import * as vscode from 'vscode';
import { extension_name } from '@/constants';
import { getConfigValue } from '@/libraries/client/settings/configUtils';


// C:\portfolio\fmus-lib\fmus-ts\fmus-vscode\src\codelens.ts
// export class FMUSCodeLensProvider implements vscode.CodeLensProvider {
export class FMUSCodeLensProvider implements vscode.CodeLensProvider<vscode.CodeLens> {
  onDidChangeCodeLenses?: vscode.Event<void> | undefined;

  // constructor() {
  //   vscode.workspace.onDidChangeTextDocument((e) => { });
  // }
  // provideCodeLenses(
  //   document: vscode.TextDocument,
  //   token: vscode.CancellationToken
  // ):
  //   // vscode.CodeLens[]
  //   vscode.ProviderResult<vscode.CodeLens[]> {
  public provideCodeLenses(document: vscode.TextDocument, token: vscode.CancellationToken): vscode.ProviderResult<vscode.CodeLens[]> {
    const topOfDocument = new vscode.Range(0, 0, 0, 0);
    const secondLineStart = new vscode.Position(1, 0); // Line index starts from 0
    const secondLineEnd = new vscode.Position(1, 0); // Same line and column for a single position
    // const secondLineRange = new vscode.Range(secondLineStart, secondLineEnd); // Create a range object, ini muncul jika editor punya minimal 1 baris
    // const thirdLineRange = new vscode.Range(new vscode.Position(2, 0), new vscode.Position(2, 0));

    const config = vscode.workspace.getConfiguration(extension_name);
    // const showPrimaryCommands = config.get('showPrimaryCommands', true);
    const showPrimaryCommands = getConfigValue<boolean>('showPrimaryCommands', false);
    const showSecondaryCommands = getConfigValue<boolean>('showSecondaryCommands', false);
    const showLLMRawQuery = getConfigValue<boolean>('showLLMRawQuery', false);
    const showLLMCodeQuery = getConfigValue<boolean>('showLLMCodeQuery', false);
    const showLLMStreamingQuery = getConfigValue<boolean>('showLLMStreamingQuery', false);
    const showLLMFmusQuery = getConfigValue<boolean>('showLLMFmusQuery', false);
    const showLLMMultimodalQuery = getConfigValue<boolean>('showLLMMultimodalQuery', false);
    const showFmusVscodeCommands = getConfigValue<boolean>('showFmusVscodeCommands', false);
    const showFmusVscodeProjectWork = getConfigValue<boolean>('showFmusVscodeProjectWork', false);

    const showInputBoxForPrompt = vscode.workspace.getConfiguration('yutools').get('showInputBoxForPrompt');
    const inputBoxTitle = showInputBoxForPrompt ? 'üü¢Input' : 'üî¥No-Input';
    const showLLMResponseBeside = vscode.workspace.getConfiguration('yutools').get('showLLMResponseBeside');
    const activeOrBesideTitle = showLLMResponseBeside ? 'üü¢Beside' : 'üî¥Active';

    let codeLenses: vscode.CodeLens[] = [];
    const activeEditor = vscode.window.activeTextEditor;

    if (showPrimaryCommands) {
      codeLenses = [
        ...codeLenses,

        new vscode.CodeLens(topOfDocument, { command: `${extension_name}.input_quick_exec_fmus`, title: 'FMUS' }),
        new vscode.CodeLens(topOfDocument, { command: `${extension_name}.input_quick_query_llm`, title: 'LLM' }),

        new vscode.CodeLens(topOfDocument, { command: `${extension_name}.selectActive`, title: 'Active' }),
        new vscode.CodeLens(topOfDocument, { command: `${extension_name}.selectSecondaryActive`, title: '2ndActive' }),
        new vscode.CodeLens(topOfDocument, { command: `${extension_name}.selectInvokeAll`, title: 'InvokeAll' }),
        new vscode.CodeLens(topOfDocument, { command: `${extension_name}.selectFmusFile`, title: 'FMUS completion' }),

        new vscode.CodeLens(topOfDocument, { command: `${extension_name}.get_temperature`, title: '‚¨ÖÔ∏èüå°Ô∏è' }),
        new vscode.CodeLens(topOfDocument, { command: `${extension_name}.get_maxtokens`, title: '‚¨ÖÔ∏ètokens' }),
        new vscode.CodeLens(topOfDocument, { command: `${extension_name}.get_topp`, title: '‚¨ÖÔ∏ètopp' }),

        new vscode.CodeLens(topOfDocument, { command: `${extension_name}.set_temperature`, title: '‚û°Ô∏èüå°Ô∏è' }),
        new vscode.CodeLens(topOfDocument, { command: `${extension_name}.set_maxtokens`, title: 'tokens' }),
        new vscode.CodeLens(topOfDocument, { command: `${extension_name}.set_topp`, title: 'topp' }),

      ];
    }
    if (activeEditor && activeEditor.document === document) {
      if (showSecondaryCommands) {
        const position = activeEditor.selection.active; // Get the current cursor position
        const lineText = document.lineAt(position.line).text; // Get the current line's text
        const range = new vscode.Range(position.line, 0, position.line, lineText.length); // Create a range for the current line
        // Add a CodeLens for the current line
        codeLenses.push(
          // new vscode.CodeLens(range, {
          //   title: `You are on line ${position.line + 1}`,
          //   command: 'myExtension.doSomething', // Replace with your command
          //   arguments: [lineText, position.line], // Pass the line text and line number as arguments
          // }),
          // C:\ai\yuagent\extensions\yutools\src\pages\fmus-vscode\fmus_vscode_commands.ts
          new vscode.CodeLens(range, { command: `${extension_name}.quickQuery`, title: 'quickQuery' }),
          new vscode.CodeLens(range, { command: `${extension_name}.code_query`, title: 'code_query' }),
          new vscode.CodeLens(range, { command: `${extension_name}.error_query`, title: 'error_query' }),
        );
      }

      if (showLLMRawQuery) {
        const position = activeEditor.selection.active;
        const lineText = document.lineAt(position.line).text;
        const range = new vscode.Range(position.line, 0, position.line, lineText.length);
        codeLenses.push(
          new vscode.CodeLens(range, { command: `yutools.llm.cerebras.sendPrompt`, title: 'ü§ñCerebras' }),
          new vscode.CodeLens(range, { command: `yutools.llm.cohere.sendPrompt`, title: 'ü§ñCohere' }),
          new vscode.CodeLens(range, { command: `yutools.geminiv2.geminiStreamCollected`, title: 'ü§ñGemini' }),
          new vscode.CodeLens(range, { command: `yutools.llm.glhf.sendPrompt`, title: 'ü§ñGLHF' }),
          new vscode.CodeLens(range, { command: `yutools.llm.groq.sendPrompt`, title: 'ü§ñGroq' }),
          new vscode.CodeLens(range, { command: `yutools.llm.huggingface.sendPrompt`, title: 'ü§ñHF' }),
          new vscode.CodeLens(range, { command: `yutools.llm.hyperbolic.sendPrompt`, title: 'ü§ñHyperbolic' }),
          new vscode.CodeLens(range, { command: `yutools.llm.openai.sendPrompt`, title: 'ü§ñOpenAI' }),
          new vscode.CodeLens(range, { command: `yutools.llm.sambanova.sendPrompt`, title: 'ü§ñSambanova' }),
          new vscode.CodeLens(range, { command: `yutools.llm.together.sendPrompt`, title: 'ü§ñTogether' }),
          new vscode.CodeLens(range, { command: `yutools.llm.xai.sendPrompt`, title: 'ü§ñXAI' }),
          // ---
          new vscode.CodeLens(range, { command: `yutools.toggleShowLLMRawQuery`, title: 'Hide' }),
          new vscode.CodeLens(range, { command: `yutools.llm.settings.changeSettings3`, title: '‚öôÔ∏è' }),
          new vscode.CodeLens(range, { command: `yutools.toggleShowInputBoxForPrompt`, title: inputBoxTitle }),
          new vscode.CodeLens(range, { command: `yutools.toggleShowLLMResponseBeside`, title: activeOrBesideTitle }),
        );
      }

      if (showLLMCodeQuery) {
        const position = activeEditor.selection.active;
        const lineText = document.lineAt(position.line).text;
        const range = new vscode.Range(position.line, 0, position.line, lineText.length);
        codeLenses.push(
          new vscode.CodeLens(range, { command: `yutools.llm.cerebras.sendPromptCode`, title: 'üìüCerebras' }),
          new vscode.CodeLens(range, { command: `yutools.llm.cohere.sendPromptCode`, title: 'üìüCohere' }),
          new vscode.CodeLens(range, { command: `yutools.llm.gemini.sendPromptCode`, title: 'üìüGemini' }),
          new vscode.CodeLens(range, { command: `yutools.llm.glhf.sendPromptCode`, title: 'üìüGLHF' }),
          new vscode.CodeLens(range, { command: `yutools.llm.groq.sendPromptCode`, title: 'üìüGroq' }),
          new vscode.CodeLens(range, { command: `yutools.llm.huggingface.sendPromptCode`, title: 'üìüHF' }),
          new vscode.CodeLens(range, { command: `yutools.llm.hyperbolic.sendPromptCode`, title: 'üìüHyperbolic' }),
          new vscode.CodeLens(range, { command: `yutools.llm.openai.sendPromptCode`, title: 'üìüOpenAI' }),
          new vscode.CodeLens(range, { command: `yutools.llm.sambanova.sendPromptCode`, title: 'üìüSambanova' }),
          new vscode.CodeLens(range, { command: `yutools.llm.together.sendPromptCode`, title: 'üìüTogether' }),
          new vscode.CodeLens(range, { command: `yutools.llm.xai.sendPromptCode`, title: 'üìüXAI' }),
          // ---
          new vscode.CodeLens(range, { command: `yutools.toggleShowLLMCodeQuery`, title: 'Hide' }),
          new vscode.CodeLens(range, { command: `yutools.llm.settings.changeSettings3`, title: '‚öôÔ∏è' }),
          new vscode.CodeLens(range, { command: `yutools.toggleShowInputBoxForPrompt`, title: inputBoxTitle }),
          new vscode.CodeLens(range, { command: `yutools.toggleShowLLMResponseBeside`, title: activeOrBesideTitle }),
        );
      }

      if (showLLMStreamingQuery) {
        const position = activeEditor.selection.active;
        const lineText = document.lineAt(position.line).text;
        const range = new vscode.Range(position.line, 0, position.line, lineText.length);
        codeLenses.push(
          // C:\ai\yuagent\extensions\yutools\src\libraries\client\editors\editor_streamer_command.ts
          new vscode.CodeLens(range, { command: `yutools.streaming.gemini.streamResponse`, title: 'üî†Gemini' }),
          new vscode.CodeLens(range, { command: `yutools.streaming.huggingface.streamResponse`, title: 'üî†HF' }),
          new vscode.CodeLens(range, { command: `yutools.streaming.huggingface.streamResponseOAI`, title: 'üî†HF-OAI' }),
          new vscode.CodeLens(range, { command: `yutools.streaming.hyperbolic.streamResponse`, title: 'üî†Hyperbolic' }),
          new vscode.CodeLens(range, { command: `yutools.streaming.openai.streamResponse`, title: 'üî†OAI' }),
          new vscode.CodeLens(range, { command: `yutools.streaming.sambanova.streamResponse`, title: 'üî†Sambanova' }),
          new vscode.CodeLens(range, { command: `yutools.streaming.together.streamResponse`, title: 'üî†Together' }),
          new vscode.CodeLens(range, { command: `yutools.streaming.xai.streamResponse`, title: 'üî†XAI' }),

          // new vscode.CodeLens(range, { command: `yutools.llm.sambanova.sendPromptCode`, title: 'üî†Sambanova' }),
          // new vscode.CodeLens(range, { command: `yutools.llm.xai.sendPromptCode`, title: 'üî†XAI' }),
          // ---
          new vscode.CodeLens(range, { command: `yutools.toggleShowLLMStreamingQuery`, title: 'Hide' }),
          new vscode.CodeLens(range, { command: `yutools.llm.settings.changeSettings3`, title: '‚öôÔ∏è' }),
          new vscode.CodeLens(range, { command: `yutools.toggleShowInputBoxForPrompt`, title: inputBoxTitle }),
          new vscode.CodeLens(range, { command: `yutools.toggleShowLLMResponseBeside`, title: activeOrBesideTitle }),
        );
      }

      if (showLLMMultimodalQuery) {
        const position = activeEditor.selection.active;
        const lineText = document.lineAt(position.line).text;
        const range = new vscode.Range(position.line, 0, position.line, lineText.length);
        const rangeNext = new vscode.Range(position.line+1, 0, position.line+1, lineText.length);
        codeLenses.push(
          new vscode.CodeLens(range, { command: `yutools.multimodal.gemini.generateFromFileDialog`, title: 'üì∑GMüóÇÔ∏èüîπ' }),
          new vscode.CodeLens(range, { command: `yutools.multimodal.gemini.textGenMultimodalOneImagePrompt`, title: 'üì∑GMüóÇÔ∏èüî∏' }),
          new vscode.CodeLens(range, { command: `yutools.multimodal.gemini.generateFromClipboard`, title: 'üì∑GMüìãüîπ' }),

          new vscode.CodeLens(range, { command: `yutools.multimodal.groqVision.analyzeImageFile`, title: 'üì∑GQüóÇÔ∏èüîπ' }),
          new vscode.CodeLens(range, { command: `yutools.multimodal.groqVision.analyzeImageUrl`, title: 'üì∑GQüåêüîπ' }),
          new vscode.CodeLens(range, { command: `yutools.multimodal.groqVision.analyzeClipboardImage`, title: 'üì∑GQüìãüîπ' }),

          new vscode.CodeLens(range, { command: "yutools.llm.huggingface.generateImage", title: "üì∑HF‚ú®" }),
          // C:\ai\yuagent\extensions\yutools\src\libraries\ai\huggingface\vision-commands\imageToText.ts
          new vscode.CodeLens(range, { command: "yutools.llm.huggingface.imageToText", title: "üì∑HF image2text" }),
          new vscode.CodeLens(range, { command: "yutools.llm.huggingface.transformImage", title: "üì∑HF transform" }),
          new vscode.CodeLens(range, { command: "yutools.llm.huggingface.visualQuestionAnswering", title: "üì∑HF vizüí¨" }),
          new vscode.CodeLens(range, { command: "yutools.llm.huggingface.documentQuestionAnswering", title: "üì∑HF docüí¨" }),

          // new vscode.CodeLens(range, { command: "yutools.multimodal.together.setDefaultSettings", title: "Together set default settings" }),
          new vscode.CodeLens(range, { command: "yutools.multimodal.together.generateImage", title: "üì∑T‚ú®" }),
          new vscode.CodeLens(range, { command: "yutools.multimodal.together.uploadImage", title: "üì∑T‚¨ÜÔ∏è" }),
          new vscode.CodeLens(range, { command: "yutools.multimodal.together.describeImageUrl", title: "üì∑Tüåê-Stream" }),
          new vscode.CodeLens(range, { command: "yutools.multimodal.together.describeLocalImage", title: "üì∑TüóÇÔ∏è-Stream" }),

          // ---
          new vscode.CodeLens(rangeNext, { command: `yutools.toggleShowLLMMultimodalQuery`, title: 'Hide' }),
          new vscode.CodeLens(rangeNext, { command: `yutools.llm.settings.changeSettings3`, title: '‚öôÔ∏è' }),
          new vscode.CodeLens(rangeNext, { command: `yutools.toggleShowInputBoxForPrompt`, title: inputBoxTitle }),
          new vscode.CodeLens(rangeNext, { command: `yutools.toggleShowLLMResponseBeside`, title: activeOrBesideTitle }),
        );
      }

      if (showLLMFmusQuery) {
        const position = activeEditor.selection.active;
        const lineText = document.lineAt(position.line).text;
        const range = new vscode.Range(position.line, 0, position.line, lineText.length);
        codeLenses.push(
          new vscode.CodeLens(range, { command: `yutools.llm.cerebras.sendPromptWithFilePrefix`, title: 'üî∑Cerebras' }),
          new vscode.CodeLens(range, { command: `yutools.llm.cohere.sendPromptWithFilePrefix`, title: 'üî∑Cohere' }),
          new vscode.CodeLens(range, { command: `yutools.llm.gemini.sendPromptWithFilePrefix`, title: 'üî∑Gemini' }),
          new vscode.CodeLens(range, { command: `yutools.llm.glhf.sendPromptWithFilePrefix`, title: 'üî∑GLHF' }),
          new vscode.CodeLens(range, { command: `yutools.llm.groq.sendPromptWithFilePrefix`, title: 'üî∑Groq' }),
          new vscode.CodeLens(range, { command: `yutools.llm.huggingface.sendPromptWithFilePrefix`, title: 'üî∑HF' }),
          new vscode.CodeLens(range, { command: `yutools.llm.hyperbolic.sendPromptWithFilePrefix`, title: 'üî∑Hyperbolic' }),
          new vscode.CodeLens(range, { command: `yutools.llm.openai.sendPromptWithFilePrefix`, title: 'üî∑OpenAI' }),
          new vscode.CodeLens(range, { command: `yutools.llm.sambanova.sendPromptWithFilePrefix`, title: 'üî∑Sambanova' }),
          new vscode.CodeLens(range, { command: `yutools.llm.together.sendPromptWithFilePrefix`, title: 'üî∑Together' }),
          new vscode.CodeLens(range, { command: `yutools.llm.xai.sendPromptWithFilePrefix`, title: 'üî∑XAI' }),
          // ---
          new vscode.CodeLens(range, { command: `yutools.toggleShowLLMFmusQuery`, title: 'Hide' }),
          new vscode.CodeLens(range, { command: `yutools.llm.settings.changeSettings3`, title: '‚öôÔ∏è' }),
          new vscode.CodeLens(range, { command: `yutools.toggleShowInputBoxForPrompt`, title: inputBoxTitle }),
          new vscode.CodeLens(range, { command: `yutools.toggleShowLLMResponseBeside`, title: activeOrBesideTitle }),
        );
      }

      if (showFmusVscodeProjectWork) {
        const position = activeEditor.selection.active;
        const lineText = document.lineAt(position.line).text;
        const range = new vscode.Range(position.line, 0, position.line, lineText.length);
        codeLenses.push(
          // C:\ai\yuagent\extensions\yutools\src\pages\fmus-vscode\fmus_vscode_commands.ts
          new vscode.CodeLens(range, { command: `yutools.work.applyUpworkCommand`, title: 'üíºApply upwork' }),
          new vscode.CodeLens(range, { command: `yutools.work.applyRemoteWork`, title: 'üíºApply remote work' }),
          new vscode.CodeLens(range, { command: `yutools.work.resumeRemoteWork`, title: 'üíºResume for remote work' }),

          new vscode.CodeLens(range, { command: `yutools.projects.fmusFormatCommand`, title: 'Prompt => FMUS' }),
          new vscode.CodeLens(range, { command: `yutools.projects.createProject`, title: 'Prompt => Project' }),
          new vscode.CodeLens(range, { command: `yutools.work.performResearch`, title: 'Perform research' }),
          // ---
          new vscode.CodeLens(range, { command: `yutools.toggleShowFmusVscodeProjectWork`, title: 'Hide' }),
        );
      }

      if (showFmusVscodeCommands) {
        const position = activeEditor.selection.active;
        const lineText = document.lineAt(position.line).text;
        const range = new vscode.Range(position.line, 0, position.line, lineText.length);
        codeLenses.push(
          new vscode.CodeLens(range, { command: "yutools.fmus-vscode.createMemorableStory", title: "üß© createMemorableStory" }),
          new vscode.CodeLens(range, { command: "yutools.fmus-vscode.createProjectSkeleton", title: "üß© createProjectSkeleton" }),
          new vscode.CodeLens(range, { command: "yutools.fmus-vscode.fixEnglishGrammar", title: "üß© fixEnglishGrammar" }),
          new vscode.CodeLens(range, { command: "yutools.fmus-vscode.generateBook", title: "üß© generateBook" }),
          new vscode.CodeLens(range, { command: "yutools.fmus-vscode.generateBlogPost", title: "üß© generateBlogPost" }),
          new vscode.CodeLens(range, { command: "yutools.fmus-vscode.generateCodeFromFuzzyPrompt", title: "üß© generateCodeFromFuzzyPrompt" }),
          new vscode.CodeLens(range, { command: "yutools.fmus-vscode.generateTechnicalArticle", title: "üß© generateTechnicalArticle" }),
          new vscode.CodeLens(range, { command: "yutools.fmus-vscode.podomoro_planner", title: "üß© podomoro_planner" }),
          new vscode.CodeLens(range, { command: "yutools.fmus-vscode.ragCurrentFolder", title: "üß© ragCurrentFolder" }),
          new vscode.CodeLens(range, { command: "yutools.fmus-vscode.refactorCodeWithExplanation", title: "üß© refactorCodeWithExplanation" }),
          new vscode.CodeLens(range, { command: "yutools.fmus-vscode.researchWithTools", title: "üß© researchWithTools" }),
          new vscode.CodeLens(range, { command: "yutools.fmus-vscode.researchRole", title: "üß© researchRole" }),
          new vscode.CodeLens(range, { command: "yutools.fmus-vscode.summarizeWebPage", title: "üß© summarizeWebPage" }),
          new vscode.CodeLens(range, { command: "yutools.fmus-vscode.summarizeYoutubeVideo", title: "üß© summarizeYoutubeVideo" }),
          // ---
          new vscode.CodeLens(range, { command: `yutools.toggleShowFmusVscodeCommands`, title: 'Hide' }),
        );
      }

    }

    return codeLenses;
  }

}
